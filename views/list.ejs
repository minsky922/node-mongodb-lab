<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="main.css" rel="stylesheet">
</head>

<body class="grey-bg">
    <%- include('nav.ejs') %>

        <input class="search">
        <button class="search-send">ê²€ìƒ‰</button>
        <script>
            document.querySelector('.search-send').addEventListener('click', function () {
                let input = document.querySelector('.search').value
                location.href = '/search?val=' + input
            })
        </script>
        <div class="white-bg">
            <% for (let i=0; i<ê¸€ëª©ë¡.length; i++){ %>
                <div class="list-box">
                    <h4>
                        <a href="/detail/<%= ê¸€ëª©ë¡[i]._id %>">
                            <%= ê¸€ëª©ë¡[i].title %>
                        </a>
                        <!-- <%= ê¸€ëª©ë¡[i]._id %> -->
                        <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
                        <span class="delete" data-id="<%= ê¸€ëª©ë¡[i]._id %>">ğŸ—‘ï¸</span>
                    </h4>
                    <p>ê¸€ë‚´ìš©ì„</p>
                </div>
                <% } %>
        </div>

        <!-- console.log(<%= ê¸€ëª©ë¡.length-1 %>) -->
        <a href="/list/next/<%= ê¸€ëª©ë¡[ê¸€ëª©ë¡.length - 1]._id %>">ë‹¤ìŒ</a>

        <script>
            // console.log('<%= ê¸€ëª©ë¡[0]._id %>')
            document.querySelectorAll('.delete')[0]
                .addEventListener('click', function (e) {
                    // ì„œë²„ì— ì‚­ì œìš”ì²­ë‚ ë¦¬ê¸°

                    fetch('/delete?docid=' + e.target.dataset.id, {
                        method: 'DELETE'
                    })
                })

            document.querySelectorAll('.delete')[1]
                .addEventListener('click', function (e) {
                    // ì„œë²„ì— ì‚­ì œìš”ì²­ë‚ ë¦¬ê¸°

                    fetch('/delete?docid=' + e.target.dataset.id, {
                        method: 'DELETE'
                    })
                        .then((r) => r.text())
                        .then((r) => { console.log(r) })

                })

            fetch('/URL')
                .then((r) => {
                    if (r.status == 200) {
                        return r.json()
                    } else {
                        //ì„œë²„ê°€ ì—ëŸ¬ì½”ë“œì „ì†¡ì‹œ ì‹¤í–‰í• ì½”ë“œ
                        alert('ì—ëŸ¬ë‚¨')
                    }
                })
                .then((result) => {
                    //ì„±ê³µì‹œ ì‹¤í–‰í• ì½”ë“œ
                }).catch((error) => {
                    //ì¸í„°ë„·ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í• ì½”ë“œ
                    console.log(error)
                })
        </script>
</body>

</html>